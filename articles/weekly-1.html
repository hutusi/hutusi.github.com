<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>周刊开刊 | 胡涂说</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="周刊开刊" />
<meta name="author" content="hutusi" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="阮一峰在两年前开始做周刊，记录每周值得分享的科技内容，目前已经做到99期了。受他的启发，我也尝试写写周刊，一是总结自己的一周或几周所看所学，二是做个记录和分享。为了避免重蹈先前每天一篇公众号文章的覆辙，我不会限定每周一刊，可能两周，也可能四周，视情形而定。" />
<meta property="og:description" content="阮一峰在两年前开始做周刊，记录每周值得分享的科技内容，目前已经做到99期了。受他的启发，我也尝试写写周刊，一是总结自己的一周或几周所看所学，二是做个记录和分享。为了避免重蹈先前每天一篇公众号文章的覆辙，我不会限定每周一刊，可能两周，也可能四周，视情形而定。" />
<link rel="canonical" href="https://hutusi.com/articles/weekly-1" />
<meta property="og:url" content="https://hutusi.com/articles/weekly-1" />
<meta property="og:site_name" content="胡涂说" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-21T14:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="周刊开刊" />
<meta name="twitter:site" content="@" />
<meta name="twitter:creator" content="@hutusi" />
<script type="application/ld+json">
{"datePublished":"2020-03-21T14:00:00+00:00","description":"阮一峰在两年前开始做周刊，记录每周值得分享的科技内容，目前已经做到99期了。受他的启发，我也尝试写写周刊，一是总结自己的一周或几周所看所学，二是做个记录和分享。为了避免重蹈先前每天一篇公众号文章的覆辙，我不会限定每周一刊，可能两周，也可能四周，视情形而定。","url":"https://hutusi.com/articles/weekly-1","@type":"BlogPosting","dateModified":"2020-03-21T14:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://hutusi.com/articles/weekly-1"},"author":{"@type":"Person","name":"hutusi"},"headline":"周刊开刊","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/main.css">
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700"> -->

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">

  <!-- RSS -->
  <link type="application/atom+xml" rel="alternate" href="https://hutusi.com/feed.xml" title="胡涂说" />

  <!-- Google Analytics-->
  
    <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-30399492-1', 'auto');
  ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  

  <!-- Google AdSense-->
  <script data-ad-client="ca-pub-7800526822107892" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>


  <body>

    <nav class="nav">
  <div class="nav-container">
    <a href="/">
      <h2 class="nav-title">胡涂说</h2>
    </a>

    <ul><li class='nav-item' role='presentation'>
              <a class='nav-link' href='/about/'>关于</a>
            </li><li class='nav-item' role='presentation'>
              <a class='nav-link' href='/archive/'>归档</a>
            </li><li class='nav-item' role='presentation'>
              <a class='nav-link' href='/links/'>友链</a>
            </li><li class='nav-item' role='presentation'>
              <a class='nav-link' href='/toolbox/'>有用</a>
            </li><li class='nav-item' role='presentation'>
              <a class='nav-link' href='/subscription/'>订阅</a>
            </li>
    </ul>
  </div>
</nav>


    <main>
      <div class="post">
  <h1 class="post-title">周刊开刊</h1>
  <h2 class="post-subtitle">开刊, Covid-19, 6.824, Go, MapReduce, GFS, BigTable</h2>

  <div class="post-info">
    
      <time datetime="2020-03-21 14:00:00 +0000">March 21, 2020</time>
    
  </div>

  <p><a href="http://www.ruanyifeng.com/blog/" target="_blank">阮一峰</a>在两年前开始做周刊，记录每周值得分享的科技内容，目前已经做到<a href="http://www.ruanyifeng.com/blog/2020/03/weekly-issue-99.html" target="_blank">99期</a>了。受他的启发，我也尝试写写周刊，一是总结自己的一周或几周所看所学，二是做个记录和分享。为了避免重蹈先前每天一篇公众号文章的覆辙，我不会限定每周一刊，可能两周，也可能四周，视情形而定。</p>

<h2 id="文摘">文摘</h2>

<p>我的中文信息主要来源是微信，英文信息主要来源是 <a href="https://twitter.com/hutusi" target="_blank">twitter</a> 和 <a href="https://getpocket.com/" target="_blank">Pocket</a>. Pocket 是一个稍后阅读的应用，我利用 <a href="https://ifttt.com/" target="_blank">IFTTT</a> 自动每天或每周推送最新文章，目前主要有 <a href="https://www.economist.com/" target="_blank">The Economist</a> 和 <a href="https://www.nytimes.com/" target="_blank">The New York Times</a> 两个主动推动的 applet.</p>

<p>我会尽可能多的选取英文文摘，为了逼着自己学英语。所选文章来自网络，不代表个人观点。最近看到的大部分文章都是关于新冠病毒(Covid-19)的，病毒已经在全球蔓延，估计短时间结束疫情是不可能了。</p>

<h3 id="1-the-100-greatest-designs-of-modern-times">1. <a href="https://fortune.com/longform/100-best-designs/" target="_blank">The 100 greatest designs of modern times</a></h3>

<p>财富杂志在1959年评选了 <a href="https://content.fortune.com/wp-content/uploads/2020/03/100-Best-Designs.pdf" target="_blank">THE 100 “BEST DESIGNED” PRODUCTS</a>, 于去年(2019) 60周年之际，再次进行了评选。 前十名分别是 iPhone(2007), Macintosh(1984), Google(1997), Eames Fiberglass Armchair(1950), Sony Walkman TPS-L2(1979), OXO Good Grips Peeler(1990), Uber Rideshare(2009), Netflix Streaming(1997), Lego Building Blocks(1939), iPod(2001). 国内入选的产品有 WeChat(2011), Mobike(2015).</p>

<h3 id="2-why-telling-people-they-dont-need-masks-backfired">2. <a href="https://app.getpocket.com/read/2918437247" target="_blank">Why Telling People They Don’t Need Masks Backfired</a></h3>

<p>新冠疫情在全球蔓延时，各国的应对策略都不太一样。其中有一个明显的区别是国内宣传是必须要戴口罩，而国外大部分官方和主流媒体都建议是不要戴口罩，其理由主要是“只有病人才需要戴口罩避免传染给他人”。但这个理由稍加推敲站不住脚：首先 covid-19 病毒潜伏期长，未发病人也有传染性；再者从主动防护的角度来说大家都戴是最能防护的。不明白这种论调为什么被国外主流媒体一再宣传，终于看到一篇对这种言论反驳的文章。文章认为尽管官方一直指导普通人不需要戴口罩，但实际上适得其反，口罩在市面上被哄抢导致紧缺，主要原因是：</p>

<ol>
  <li>卫生专家认为普通人不要口罩而医护人员需要，这是矛盾的：难道口罩只能在特定医护场所才有效果？</li>
  <li>专家认为普通人一般口罩戴的方法不正确。但很多人洗手的方法也不正确，我们提供各种指导让民众正确洗手，戴口罩也应如是。</li>
  <li>口罩当然有用。经历过2003 SARS 的中国以及亚洲国家官员都建议戴口罩。</li>
  <li>WHO 和 CDC 告诉民众病人需要戴口罩，但目前有越来越多的无症状传染案例，尤其是年轻人和轻症患者在不清楚自己染病的情况下仍具有传染性。</li>
  <li>香港等地与中国大陆人员来往频繁，而早期的普遍隔离和戴口罩策略使得他们很好的控制了传染病。</li>
  <li>口罩是一个象征团结的符号，让公民更加意识到大家应该同舟共济。</li>
  <li>给出不戴口罩这种明显矛盾的指导只能适得其反，因为缺乏信任会加剧哄抢和假消息的蔓延。</li>
</ol>

<h3 id="3-even-tiny-pacific-islands-cannot-escape-covid-19">3. <a href="https://app.getpocket.com/read/2921142452" target="_blank">Even tiny Pacific islands cannot escape covid-19</a></h3>

<p>太平洋上的很多小岛显得避世独立远离喧嚣，甚至被宣传成远离世界末日的净土，但如果你认为他们能远离 Covid-19, 无疑痴人说梦。没有哪个岛屿是孤岛(No island is island).</p>

<p>文章的这句 No island is an island 应该是改编自诗人 John Donne《沉思录》的一句 “No man is an island.”</p>

<h3 id="4-covid-19-is-exposing-americas-resilienceand-vulnerability">4. <a href="https://app.getpocket.com/read/2921132567" target="_blank">Covid-19 is exposing America’s resilience—and vulnerability</a></h3>

<p>就像网上说的：“疫情是面放大镜”。确实如此，文中引述了一位评论者的话：美国长期习惯了认为自己是世界上最好、效率最高、科技最先进的社会，正被证实为是一个褪去新衣的皇帝。(“long accustomed to thinking of itself as the best, most efficient, and most technically advanced society in the world, is about to be proved an unclothed emperor.”)</p>

<h2 id="技术">技术</h2>

<h3 id="1-6824">1. <a href="https://pdos.csail.mit.edu/6.824/" target="_blank">6.824</a></h3>

<p>在 <a href="https://geektutu.com/" target="_blank">geektutu</a> 的推荐下(下面的 Go、Google 三篇论文也得益于他的讲解)开始学习 <a href="https://pdos.csail.mit.edu/6.824/" target="_blank">6.824</a>, 这是也被誉为分布式系统的神级课程，是 MIT 推出并公开的在线课程。每节课几乎都对要解读一篇分布式领域的经典论文，课后还有分布式 Lab, 动手用 Go 语言写分布式系统实现，包括经典的 MapReduce、Raft 等。</p>

<h3 id="2-go-语言">2. <a href="https://golang.org/" target="_blank">Go 语言</a></h3>

<p>本周及上周因为学习 6.824 也相应入门了 Go 语言。Go 语言很像 C 语言(都是 Ken Thompson 参与设计的嘛)，语法简洁。接近于 C 的运行效率 + Goroutine + 垃圾回收，让它在并发计算上具有很大优势，因此在分布式云计算领域应用很广泛，docker 就是用 Go 编写。</p>

<p>不过 Go 语言因为考虑设计的简洁，没有引入过多的语法，在降低学习成本的同时，也少了很多其他语言的语法糖，显得不那么fancy，不过反倒是这种淳朴的内在更利于工业级的开发应用。</p>

<ul>
  <li>入门参考: <a href="https://geektutu.com/post/quick-golang.html" target="_blank">Go 语言简明教程</a></li>
  <li>官方入门指导: <a href="https://tour.golang.org/" target="_blank">A Tour of Go</a></li>
</ul>

<h3 id="3-mapreduce">3. <a href="https://en.wikipedia.org/wiki/MapReduce" target="_blank">MapReduce</a></h3>

<p>MapReduce 是一种分布式计算的编程模型，用于大规模数据集的并行计算。它的主要思想是通过 Map 和 Reduce 两个阶段将数据处理分发再归约。</p>

<p>MapRecude 编程模型如下图示：</p>

<p><img src="/images/posts/mapreduce.png" alt="Map Reduce" /></p>

<ol>
  <li>用户程序调用 MapReduce 库将输入文件分成 M 个数据片段。然后用户程序在集群中创建大量程序副本。</li>
  <li>其中一个程序副本是 master 进程，其余都是 worker. 由 master 分配任务。有 M 个 map 任务和 R 个 reduce 任务被分配。master 将一个任务分配给一个空闲的 worker.</li>
  <li>被分配了 map 任务的 worker 读取相关输入数据片段，从输入数据中解析出 key/value pair, 然后将 key/value 传给用户自定义的 map 函数，由 map 函数输出中间结果存成 key/value 格式，并缓存在内存中。</li>
  <li>缓存的 key/value pair 通过分区函数（比如求 hash）分成 R 个区域，写入文件系统。存储位置被回传给 master, 由 master 负责将这些存储位置再传给 reduce worker.</li>
  <li>Reduce worker 读取所有这些中间数据后，将相同 key 值的数据聚合在一起。</li>
  <li>Reduce worker 将这个 key 值和对应所有 value 数据传给用户自定义的 reduce 函数，reduce 函数输出追加到所属 reduce 分区的输出文件。</li>
  <li>所有 map 和 reduce 任务完成后，master 唤醒用户程序，一次 MapReduce 计算完成。</li>
</ol>

<p>6.824 的<a href="https://pdos.csail.mit.edu/6.824/labs/lab-mr.html" target="_blank">第一个 Lab</a> 就是实现个简单的 MapReduce 系统，其中的单词统计用例可以帮助理解 MapReduce 模型。</p>

<p>资料：</p>

<ul>
  <li><a href="https://pdos.csail.mit.edu/6.824/papers/mapreduce.pdf" target="_blank">MapReduce 论文</a></li>
  <li><a href="http://blog.bizcloudsoft.com/wp-content/uploads/Google-MapReduce%E4%B8%AD%E6%96%87%E7%89%88_1.0.pdf" target="_blank">MapReduce 论文中文翻译</a></li>
</ul>

<h3 id="4-gfs">4. <a href="https://en.wikipedia.org/wiki/Google_File_System" target="_blank">GFS</a></h3>

<p>GFS 即谷歌文件系统(Google File System), 是谷歌大部分服务的基础。它主要的应用场景是大文件(通常 100M 以上)的读写，工作负载主要是大规模的流式读取和小规模的随机读取，以及大规模的顺序追加写。文件一般数据写入后就很少被修改。</p>

<p>GFS 架构如下图示：</p>

<p><img src="/images/posts/GFS-architecture.JPG" alt="GFS architecture" /></p>

<p>单个 GFS 集群包含一个 master 和多个 chunkserver(一般是普通 Linux 机器), GFS 将文件分割成若干个固定大小的 chunk。在 chunk 创建的时候，master 会给每个 chunk 分配不变且唯一的64位 chunk 标识。chunkserver 将 chunk 以 Linux 文件形式存储在本地，并根据 chunk 标识和字节范围来读写块数据。一般为了可靠性的考虑会有3个 chunkserver 备份。chunk 设计比较大: 64M.</p>

<p>master 管理所有的文件系统元数据信息。包括： 1. 文件和 chunk 的命名空间（前缀压缩算法存储）；2. 文件和 chunk 的映射；3. chunk 的位置信息。这三种元数据信息都存在内存中，且只有前二者会以日志形式持久化存储。</p>

<p>单一的 master 节点简化了系统设计，但也需要减少对 master 的读写，避免 master 成为瓶颈。master 只存元数据信息，当客户端询问到它应该联系的 chunkserver 后，便直接跟 chunkserver 进行读写操作。</p>

<ul>
  <li>系统交互： 通过租约(lease)机制来保证在所有 chunksever 上执行的变更操作顺序一致。</li>
  <li>数据一致性：相对松散的一致性模型（保证结果一致性）。</li>
  <li>数据完整性：通过 checksum 来检测，并通过 chunkserver 备份恢复数据。</li>
</ul>

<p>资料：</p>

<ul>
  <li><a href="https://pdos.csail.mit.edu/6.824/papers/gfs.pdf" target="_blank">GFS 论文</a></li>
  <li><a href="http://blog.bizcloudsoft.com/wp-content/uploads/Google-File-System%E4%B8%AD%E6%96%87%E7%89%88_1.0.pdf" target="_blank">GFS 论文中文翻译</a></li>
</ul>

<h3 id="5-bigtable">5. <a href="https://en.wikipedia.org/wiki/Bigtable" target="_blank">Bigtable</a></h3>

<h4 id="bigtable-的设计目标">Bigtable 的设计目标</h4>

<p>Google 提供的服务很多，需要存储的数据格式种类繁多，有海量的服务请求. 这些诉求也是 Bigtable 的设计目标：</p>

<ul>
  <li>广泛的适用性 wide applicabilityy</li>
  <li>可扩展性 scalability</li>
  <li>高性能 high performance</li>
  <li>高可用性 high availability</li>
</ul>

<h4 id="bigtable-的数据模型">Bigtable 的数据模型</h4>

<blockquote>
  <p>A Bigtable is a sparse, distributed, persistent multidimensional sorted map.</p>
</blockquote>

<p>Map 以 { row key, column key, timestamp } 为索引(key), value 是内容字符串。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(row:string, column:string,time:int64)-&gt;string
</code></pre></div></div>

<ul>
  <li>row: 每行数据拥有唯一的 row key, 所有数据按 row key 字典序排序。对一行数据的读或者写操作都是原子的。</li>
  <li>tablet: 一个连续的 row key 区间划分成一个 tablet. tablet 尺寸在 100M ~ 200M, 随着数据的增长一个 tablet 会被分裂成多个 tablets.</li>
  <li>column: column key 的命名规则为 <code class="language-plaintext highlighter-rouge">列族:限定词</code>。如 <code class="language-plaintext highlighter-rouge">anchor:cnnsi.com</code></li>
  <li>column family(列族): 一个或多个相同类型的列的集合, 权限控制的最小单元。</li>
  <li>timestamp: Bigtable 使用 timestamp 来标识不同的版本。同一个 column key 的多个版本按 timestamp 倒序存放，这样查询时总是先读取到最新的版本。每一个 column family 允许用户配置最多保留的版本数量（3个），超出的版本将会被清理掉。</li>
</ul>

<h4 id="bigtable-系统组成">Bigtable 系统组成</h4>

<p>三个组成部分：</p>

<ul>
  <li>链接到客户端的 library.</li>
  <li>1 个 master server:
    <ul>
      <li>为 tablet 分配 tablets</li>
      <li>检测新加入的或者过期失效的 table server</li>
      <li>对 tablet server 进行负载均衡
        <ul>
          <li>对保存在 GFS 上的文件进行垃圾收集</li>
          <li>schema 修改</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>多个 tablet server:
    <ul>
      <li>每个 tablet server 都管理一个 tablet 的集合 (tablets set, 10 ~ 1000 个 tablets)
        <ul>
          <li>每个 tablet server 负责处理它所加载的 tablet 的读写操作，以及在 tablet 过大时，对其进行分割。</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>tablet 定位: tablet 的位置信息存储在一个类似 B+ 树的三层结构中，通过 row key 定位 tablet。</p>

<p>tablet 分配: 同一时间，一个 tablet 只能被分配给一个 tablet server. master 通过 chubby 分布式锁服务来监测管理 tablet server.</p>

<p>tablet 读写与服务: tablet 持久化存储在 GFS 上，内存到文件系统是通过 memtable 和 SSTable 的对应转换完成。</p>

<h4 id="关键设计">关键设计</h4>

<ul>
  <li>LSM Tree (Log-Structured Merge Tree)</li>
</ul>

<p>资料：</p>

<ul>
  <li><a href="https://static.googleusercontent.com/media/research.google.com/en//archive/bigtable-osdi06.pdf" target="_blank">Bigtable 论文</a></li>
  <li><a href="http://blog.bizcloudsoft.com/wp-content/uploads/Google-Bigtable%E4%B8%AD%E6%96%87%E7%89%88_1.0.pdf" target="_blank">Bigtable 论文中文翻译</a></li>
  <li>解读: <a href="http://www.nosqlnotes.com/technotes/bigtable-keydesign/" target="_blank">回顾Bigtable的经典设计</a></li>
</ul>

<h2 id="其他">其他</h2>

<h3 id="1-rsa-panel-how-to-reduce-supply-chain-risk-lessons-from-efforts-to-block-huawei">1. <a href="https://www.rsaconference.com/usa/agenda/how-to-reduce-supply-chain-risk-lessons-from-efforts-to-block-huawei" target="_blank">RSA panel: How to Reduce Supply Chain Risk: Lessons from Efforts to Block Huawei</a></h3>

<p>RSA 是全球最知名的安全技术峰会，今年的会议上有一个 <a href="https://www.rsaconference.com/usa/agenda/how-to-reduce-supply-chain-risk-lessons-from-efforts-to-block-huawei" target="_blank">panel</a> 是专门讨论去年美国制裁华为对供应链的影响。嘉宾有: Katie Arrington(美国国防部网络信息安全官 CISO), Andy Purdy(华为首席安全官), Bruce Schneier(安全专家，《应用密码学》的作者), Kathryn Waldron(R Street 机构 Fellow).</p>

<p>Panel 的主题是如何减少供应链的网络安全风险，是站在美国的角度讨论的。Katie 是美国政府官员，聊着聊着她就回到政治上。Bruce 不止一次纠正她讨论的内容是网络安全，不是贸易战。当大家在说到如何削减网络风险时，Katie 说中国一直在偷窃美国的知识产权；当大家问她华为能不能参加跟其他公司同样的安全测试时，她两手一摊：“法律不允许啊”；当谈到网络风险是否与地域和国家有关时，她的说法是“我们是民主国家”。Bruce 的论述则一直紧扣网络安全，他认为 5G 也是不安全的，而是应该研究更安全的 6G; 那个 NSA 控制了所有技术去监控通信的时代已经过去了（意为这种不安全的传输协议也给其他国家或组织留下了后门），必须要在通信网络和 IoT 设备上提升安全等级。这个 Panel 的视频值得一看，可以侧面了解美国人的一些思维方式。</p>

<hr />

<blockquote>
  <p>奥斯卡今天已不太相信预兆。然而当时预兆却相当多，这暗示一场灾祸将临。这场灾祸穿上越来越大的皮靴，还想迈开越来越大的步伐，把不幸带到四面八方。这时，我的朋友赫伯特·特鲁钦斯基死了，一个木制女人给他的前胸添了一道创伤。这个女人却没有死。她被封存起来了，据称是为了修复而存放在博物馆的地下室里。可是，人们无法将灾祸关进地下室。灾祸同污水一起从下水道流出去，同煤气一道从煤气管道里散出去，到了每个住家。把汤锅放在蓝色火苗上煮的人，谁都没有料到，煮开他的汤的竟是灾祸。</p>

  <p>【德】君特·格拉斯《铁皮鼓》 胡其鼎 译  <br />
 (本段摘自章节 有信有望有爱)</p>
</blockquote>

</div>

<div class='tags'>
  
    <a href='/tag/周刊'>周刊</a>
  
    <a href='/tag/Covid-19'>Covid-19</a>
  
    <a href='/tag/分布式'>分布式</a>
  
    <a href='/tag/6.824'>6.824</a>
  
    <a href='/tag/Go'>Go</a>
  
    <a href='/tag/MapReduce'>MapReduce</a>
  
    <a href='/tag/GFS'>GFS</a>
  
    <a href='/tag/BigTable'>BigTable</a>
  
</div>

<div><h3>如果你觉得本文不错，欢迎<a href="/subscription">订阅“胡涂说”博客</a>。</h3></div>


  <!-- ref: gitalk -->
<!-- https://github.com/geektutu/hexo-theme-geektutu/blob/master/layout/_widget/comments.ejs#L31 -->
<!-- ref: https://geektutu.com/post/blog-experience-7.html -->

<!-- Start gitalk -->
<script src="/assets/js/gitalk.min.js" /></script>
<!-- <div id="disqus_thread"><h3>Discussion and feedback</h3></div> -->
<div id="gitalk-container">
    <div class="gt-container text-center" style="margin-top: 50px;">
        <button class="gt-btn gt-btn-public"><span class="gt-btn-text">去 Github 评论</span></button>
    </div>
</div>

<div id="gitalk-related"></div>

<script>
    window.addEventListener('load', function () {
        function renderCommentUrl(data) {
            var url = (data[window.location.pathname] || {}).url
            url && getDom('#gitalk-container button').addEventListener('click', function (e) { window.open(url)})
            url || (getDom('#gitalk-container').style.display = 'none')
        }
        function getDom(str) { return document.querySelector(str) }

        const gitalk = new Gitalk({
            clientID: '3ecf7aac87e37cbe772c',
            clientSecret: '887d16569177e1f6336cce32e9c58974c2932807',
            repo: 'hutusi.github.com',
            owner: 'hutusi',
            admin: 'hutusi',
            id: location.pathname,      // Ensure uniqueness and length less than 50
            distractionFreeMode: false  // Facebook-like distraction free mode
        })

        fetch("https://api.github.com/user").then(function(resp){
            gitalk.render('gitalk-container');
        }).catch(function(e){
            fetch('/assets/data/issues.json').then(function (r) { return r.json() }).then(renderCommentUrl).catch(function (e) { })
        })
        getDom('#gitalk-container').addEventListener('click', function (e) {
            e && e.stopPropagation && e.stopPropagation();
        });
    })
</script>
<noscript>Please enable JavaScript to view the <a href="https://gitalk.github.io/">comments powered by gitalk.</a></noscript>
<!-- End gitalk -->

<!-- gitalk plus -->
<script>
    window.addEventListener('load', function () {
        function render(comments) {
            var template = '<a href="${comment.url}?utm_source=gitalk" class="dis-item-url"><h3 class="dis-item-title">${comment.title}</h3>' +
                '<p class="dis-item-des">${comment.count} 评论 ● ${comment.date}</p>' +
                '<div class="dis-item-content"><img class="dis-item-img" src="${comment.icon}" alt="icon"><p><b><span class="dis-item-user">${comment.user}</span></b>&nbsp;——&nbsp;${comment.body}</p></div>' +
                '</a>'

            var wrapper = getDom('#gitalk-related');
            comments = shuffle(comments);
            comments.slice(0, 4).forEach(function (c) {
                var div = document.createElement('div');
                div.classList.add('dis-item');
                div.innerHTML = template.replace("${comment.url}", c.url)
                    .replace("${comment.title}", c.title)
                    .replace("${comment.count}", c.count)
                    .replace("${comment.date}", c.date)
                    .replace("${comment.icon}", c.icon)
                    .replace("${comment.user}", c.user)
                    .replace("${comment.body}", c.body)
                wrapper.appendChild(div)
            })
            var p = document.createElement('p')
            p.innerHTML = '<a href="https://geektutu.com/post/blog-experience-7.html">Gitalk Plus</a>';
            p.classList.add('dis-divide');
            wrapper.appendChild(p);
            wrapper.classList.add('dis-wrapper')
        }
        function shuffle(a) {
            for (var i = a.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }
        function getDom(str) { return document.querySelector(str) }
        fetch('/assets/data/comments.json').then(function (r) { return r.json() }).then(render).catch(function (e) { })
    })
</script>



<div class="pagination">
  
    <a href="/articles/weekly-2" class="left arrow">&#8592;</a>
  
  
    <a href="/articles/git-paging" class="right arrow">&#8594;</a>
  

  <a href="#" class="top">Top</a>
</div>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script async type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4fa6932104ee5f3f"></script>

    </main>

    <footer>
  <span>
    &copy; <time>2021</time> 胡涂说 hutusi.com <br />
    <a href="https://beian.miit.gov.cn/" target="_blank">沪ICP备19043788号-1 沪ICP备19043788号-2 沪ICP备19043788号-3</a><br />
    Made with Jekyll using the <a href="https://github.com/hutusi/tale/" target="_blank">TaleType</a> theme, 
    CDN for images sponsored by <a href="https://www.dogedoge.com/" target="_blank">多吉搜索</a>
    <br />
  </span>

  
  <div class="busuanzi-count">
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user">UV </i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye">PV </i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
  </div>

  <!-- Baidu Statistic-->
  
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?95ca94128a63c7bb77a40c9d3b73d22c";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();
</script>

<!-- baidu auto push for seo -->
<script>
  window.addEventListener('load', function () {
      var src = 'http://push.zhanzhang.baidu.com/push.js'
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      globalAddScript(src);
  })
</script>

  

  <!-- cnzz Statistic-->
  
    <div>
  <center>
    <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1278872520'%3E%3C/span%3E%3Cscript src='https://s4.cnzz.com/z_stat.php%3Fid%3D1278872520%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
  </center>
</div>

  

</footer>

  </body>
</html>
