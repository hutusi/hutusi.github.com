(()=>{(function(){let c=document.getElementById("type-nav"),d=document.getElementById("year-nav");if(!c||!d)return;let p=Array.from(c.querySelectorAll(".filter-link")),u=Array.from(d.querySelectorAll(".year-link")),h=Array.from(document.querySelectorAll(".year-block")),L=document.getElementById("count-all"),E=document.getElementById("count-post"),v=document.getElementById("count-weekly"),S=document.getElementById("count-featured"),l="all",r="all",i={};h.forEach(e=>{let t=e.dataset.year,a=Array.from(e.querySelectorAll(".archive-item")),s={post:0,weekly:0,featured:0,total:0};a.forEach(n=>{let o=n.dataset.type;o==="post"?s.post++:o==="weekly"&&s.weekly++,n.dataset.featured==="1"&&s.featured++,s.total++}),i[t]=s});let A=Object.keys(i).reduce((e,t)=>(e.post+=i[t].post,e.weekly+=i[t].weekly,e.featured+=i[t].featured,e.total+=i[t].total,e),{post:0,weekly:0,featured:0,total:0});function k(){let e=new URLSearchParams(window.location.search),t=e.get("t"),a=e.get("y");["all","featured","post","weekly"].includes(t)&&(l=t),(a==="all"||/^\d{4}$/.test(a))&&(r=a)}function q(){let e=new URLSearchParams(window.location.search);e.set("t",l),e.set("y",r);let t=window.location.pathname+"?"+e.toString();history.replaceState(null,"",t)}function w(e,t,a){e.forEach(s=>s.classList.toggle("is-active",s.getAttribute(t)===a))}function m(e,t){let a=Array.from(e.querySelectorAll(t));a.forEach(n=>{let o=n.previousSibling;o&&o.nodeType===3&&(o.textContent="")}),a.filter(n=>!n.classList.contains("is-hidden")).forEach((n,o)=>{o!==0&&n.insertAdjacentText("beforebegin"," | ")})}function b(){let e=r==="all"?A:i[r]||{post:0,weekly:0,featured:0,total:0};L.textContent=e.total,E.textContent=e.post,v.textContent=e.weekly,S.textContent=e.featured;let t=c.querySelector('.filter-link[data-filter="post"]'),a=c.querySelector('.filter-link[data-filter="weekly"]'),s=c.querySelector('.filter-link[data-filter="featured"]');t.classList.toggle("is-hidden",e.post===0),a.classList.toggle("is-hidden",e.weekly===0),s.classList.toggle("is-hidden",e.featured===0);let n=c.querySelector(`.filter-link[data-filter="${l}"]`);(!n||n.classList.contains("is-hidden"))&&(e.featured>0?l="featured":e.post>0?l="post":e.weekly>0?l="weekly":l="all"),m(c,".filter-link")}function B(){u.forEach(t=>{let a=t.dataset.year;if(a==="all"){t.classList.remove("is-hidden");return}let s=i[a]||{post:0,weekly:0,featured:0,total:0},n=!0;l==="post"&&(n=s.post>0),l==="weekly"&&(n=s.weekly>0),l==="featured"&&(n=s.featured>0),l==="all"&&(n=s.total>0),t.classList.toggle("is-hidden",!n)});let e=d.querySelector(`.year-link[data-year="${r}"]`);(!e||e.classList.contains("is-hidden"))&&(r="all"),m(d,".year-link")}function C(){h.forEach(e=>{let t=e.dataset.year,a=r==="all"||t===r,s=0;e.querySelectorAll(".archive-item").forEach(o=>{let y=!0;l==="post"||l==="weekly"?y=o.dataset.type===l:l==="featured"&&(y=o.dataset.featured==="1");let g=a&&(l==="all"?!0:y);o.classList.toggle("is-hidden",!g),g&&s++}),e.classList.toggle("is-hidden",s===0)}),w(p,"data-filter",l),w(u,"data-year",r)}function f(){b(),B(),C(),q()}p.forEach(e=>e.addEventListener("click",t=>{t.preventDefault(),!e.classList.contains("is-hidden")&&(l=e.dataset.filter||"all",f())})),u.forEach(e=>e.addEventListener("click",t=>{t.preventDefault(),!e.classList.contains("is-hidden")&&(r=e.dataset.year||"all",f())})),k(),f(),window.addEventListener("hashchange",()=>{k(),f()})})();})();
