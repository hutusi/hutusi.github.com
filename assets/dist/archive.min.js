(()=>{(function(){let c=document.getElementById("type-nav"),d=document.getElementById("year-nav");if(!c||!d)return;let h=Array.from(c.querySelectorAll(".filter-link")),u=Array.from(d.querySelectorAll(".year-link")),p=Array.from(document.querySelectorAll(".year-block")),w=document.getElementById("count-all"),L=document.getElementById("count-post"),v=document.getElementById("count-weekly"),A=document.getElementById("count-featured"),a="all",i="all",r={};p.forEach(e=>{let t=e.dataset.year,n=Array.from(e.querySelectorAll(".archive-item")),s={post:0,weekly:0,featured:0,total:0};n.forEach(l=>{let o=l.dataset.type;o==="post"?s.post++:o==="weekly"&&s.weekly++,l.dataset.featured==="1"&&s.featured++,s.total++}),r[t]=s});let S=Object.keys(r).reduce((e,t)=>(e.post+=r[t].post,e.weekly+=r[t].weekly,e.featured+=r[t].featured,e.total+=r[t].total,e),{post:0,weekly:0,featured:0,total:0});function k(){let e=(location.hash||"").replace(/^#/,"");if(!e)return;let t={};e.split("&").forEach(n=>{let[s,l]=n.split("=");s&&(t[s]=l)}),["all","featured","post","weekly"].includes(t.t)&&(a=t.t),(t.y==="all"||/^\d{4}$/.test(t.y))&&(i=t.y)}function q(){let e=`#t=${a}&y=${i}`;location.hash!==e&&(history.replaceState?history.replaceState(null,"",e):location.hash=e)}function g(e,t,n){e.forEach(s=>s.classList.toggle("is-active",s.getAttribute(t)===n))}function m(e,t){let n=Array.from(e.querySelectorAll(t));n.forEach(l=>{let o=l.previousSibling;o&&o.nodeType===3&&(o.textContent="")}),n.filter(l=>!l.classList.contains("is-hidden")).forEach((l,o)=>{o!==0&&l.insertAdjacentText("beforebegin"," | ")})}function b(){let e=i==="all"?S:r[i]||{post:0,weekly:0,featured:0,total:0};w.textContent=e.total,L.textContent=e.post,v.textContent=e.weekly,A.textContent=e.featured;let t=c.querySelector('.filter-link[data-filter="post"]'),n=c.querySelector('.filter-link[data-filter="weekly"]'),s=c.querySelector('.filter-link[data-filter="featured"]');t.classList.toggle("is-hidden",e.post===0),n.classList.toggle("is-hidden",e.weekly===0),s.classList.toggle("is-hidden",e.featured===0);let l=c.querySelector(`.filter-link[data-filter="${a}"]`);(!l||l.classList.contains("is-hidden"))&&(e.featured>0?a="featured":e.post>0?a="post":e.weekly>0?a="weekly":a="all"),m(c,".filter-link")}function B(){u.forEach(t=>{let n=t.dataset.year;if(n==="all"){t.classList.remove("is-hidden");return}let s=r[n]||{post:0,weekly:0,featured:0,total:0},l=!0;a==="post"&&(l=s.post>0),a==="weekly"&&(l=s.weekly>0),a==="featured"&&(l=s.featured>0),a==="all"&&(l=s.total>0),t.classList.toggle("is-hidden",!l)});let e=d.querySelector(`.year-link[data-year="${i}"]`);(!e||e.classList.contains("is-hidden"))&&(i="all"),m(d,".year-link")}function C(){p.forEach(e=>{let t=e.dataset.year,n=i==="all"||t===i,s=0;e.querySelectorAll(".archive-item").forEach(o=>{let y=!0;a==="post"||a==="weekly"?y=o.dataset.type===a:a==="featured"&&(y=o.dataset.featured==="1");let E=n&&(a==="all"?!0:y);o.classList.toggle("is-hidden",!E),E&&s++}),e.classList.toggle("is-hidden",s===0)}),g(h,"data-filter",a),g(u,"data-year",i)}function f(){b(),B(),C(),q()}h.forEach(e=>e.addEventListener("click",t=>{t.preventDefault(),!e.classList.contains("is-hidden")&&(a=e.dataset.filter||"all",f())})),u.forEach(e=>e.addEventListener("click",t=>{t.preventDefault(),!e.classList.contains("is-hidden")&&(i=e.dataset.year||"all",f())})),k(),f(),window.addEventListener("hashchange",()=>{k(),f()})})();})();
