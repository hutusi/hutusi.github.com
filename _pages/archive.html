---
layout: page
title: 归档
permalink: /archive/
---

{%- assign all_posts = site.posts | concat: site.weeklies -%}
{%- assign sorted_posts = all_posts | sort: 'date' | reverse -%}

{%- assign post_count = site.posts | size -%}
{%- assign weekly_count = site.weeklies | size -%}
{%- assign total_count = post_count | plus: weekly_count -%}

{%- comment -%} 收集年份列表 {%- endcomment -%}
{% assign years = "" | split: "" %}
{% for post in sorted_posts %}
  {% assign y = post.date | date: "%Y" %}
  {% unless years contains y %}
    {% assign years = years | push: y %}
  {% endunless %}
{% endfor %}
{% assign years = years | sort | reverse %}

<!-- 分类过滤 -->
<nav class="archive-filter mb-2" aria-label="Archive filters">
  <a href="#all" class="filter-link is-active" data-filter="all">全部 ({{ total_count }})</a>
  <span class="mx-2">|</span>
  <a href="#post" class="filter-link" data-filter="post">文章 ({{ post_count }})</a>
  <span class="mx-2">|</span>
  <a href="#weekly" class="filter-link" data-filter="weekly">周刊 ({{ weekly_count }})</a>
</nav>

<!-- 年份过滤 -->
<nav class="year-filter mb-3" aria-label="Year filters">
  <a href="#year-all" class="year-link is-active" data-year="all">全部年份</a>
  {% for y in years %}
    <span class="mx-2">|</span>
    <a href="#year-{{ y }}" class="year-link" data-year="{{ y }}">{{ y }}</a>
  {% endfor %}
</nav>

{%- assign year = nil -%}
{%- for post in sorted_posts -%}
  {%- capture currentyear -%}{{ post.date | date: "%Y" }}{%- endcapture -%}
  {%- if currentyear != year -%}
    {%- unless forloop.first -%}
      </ul>
    {%- endunless -%}
    <h3 class="post-archive-year">{{ currentyear }}</h3>
    <ul class="post-archive" data-year="{{ currentyear }}">
    {%- capture year -%}{{ currentyear }}{%- endcapture -%}
  {%- endif -%}

  {%- assign coll = post.collection | default: "" -%}
  {%- if coll == "posts" -%}
    {%- assign dtype = "post" -%}
    {%- assign badge = "文章" -%}
  {%- elsif coll == "weeklies" -%}
    {%- assign dtype = "weekly" -%}
    {%- assign badge = "周刊" -%}
  {%- else -%}
    {%- assign dtype = coll -%}
    {%- assign badge = coll -%}
  {%- endif -%}

  <li class="archive-item" data-type="{{ dtype }}">
    <span class="post-archive-badge" style="font-size:.8rem; color:#888; margin-right:.5rem;">{{ badge }}</span>
    <a href="{{ post.url | relative_url }}" class="post-archive-link">{{ post.title }}</a>
    <time class="post-archive-date" datetime="{{ post.date | date_to_xmlschema }}" style="margin-left:.5rem; color:#888;">
      {{ post.date | date: "%m-%d" }}
    </time>
  </li>
{%- endfor -%}
</ul>

<style>
  .filter-link, .year-link { text-decoration:none; color:#6c757d; }
  .filter-link.is-active, .year-link.is-active { color:#0d6efd; font-weight:600; }
  .archive-item.is-hidden, .post-archive.is-hidden { display:none !important; }
</style>

<script>
(function() {
  const filterLinks = Array.from(document.querySelectorAll('.filter-link'));
  const yearLinks   = Array.from(document.querySelectorAll('.year-link'));
  const items       = Array.from(document.querySelectorAll('.archive-item'));
  const yearBlocks  = Array.from(document.querySelectorAll('.post-archive'));

  function applyTypeFilter(filter) {
    items.forEach(li => {
      const show = (filter === 'all') || (li.dataset.type === filter);
      li.classList.toggle('is-hidden', !show);
    });
  }

  function applyYearFilter(year) {
    yearBlocks.forEach(ul => {
      const show = (year === 'all') || (ul.dataset.year === year);
      ul.classList.toggle('is-hidden', !show);
    });
  }

  function setActive(links, target) {
    links.forEach(a => a.classList.toggle('is-active', a === target));
  }

  filterLinks.forEach(a => {
    a.addEventListener('click', e => {
      e.preventDefault();
      setActive(filterLinks, a);
      applyTypeFilter(a.dataset.filter);
    });
  });

  yearLinks.forEach(a => {
    a.addEventListener('click', e => {
      e.preventDefault();
      setActive(yearLinks, a);
      applyYearFilter(a.dataset.year);
    });
  });

  // 初始状态
  applyTypeFilter('all');
  applyYearFilter('all');
})();
</script>
