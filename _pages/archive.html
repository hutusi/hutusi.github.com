---
layout: page
title: 归档
permalink: /archive/
---

{%- assign all_posts = site.posts | concat: site.weeklies -%}
{%- assign sorted_posts = all_posts | sort: 'date' | reverse -%}

{%- assign post_count = site.posts | size -%}
{%- assign weekly_count = site.weeklies | size -%}
{%- assign total_count = post_count | plus: weekly_count -%}

{%- comment -%} 收集年份列表 {%- endcomment -%}
{% assign years = "" | split: "" %}
{% for post in sorted_posts %}
  {% assign y = post.date | date: "%Y" %}
  {% unless years contains y %}
    {% assign years = years | push: y %}
  {% endunless %}
{% endfor %}
{% assign years = years | sort | reverse %}

<!-- 第一行：类型过滤（纯文字分隔符，顺序：全部 | 精选 | 文章 | 周刊） -->
<nav class="archive-filter mb-2" aria-label="Archive filters" id="type-nav">
  <a href="#t=all" class="filter-link is-active" data-filter="all">
    全部 (<span id="count-all">{{ total_count }}</span>)
  </a> | 
  <a href="#t=featured" class="filter-link" data-filter="featured">
    精选 (<span id="count-featured">0</span>)
  </a> | 
  <a href="#t=post" class="filter-link" data-filter="post">
    文章 (<span id="count-post">{{ post_count }}</span>)
  </a> | 
  <a href="#t=weekly" class="filter-link" data-filter="weekly">
    周刊 (<span id="count-weekly">{{ weekly_count }}</span>)
  </a>
</nav>

<!-- 第二行：年份过滤（纯文字分隔符） -->
<nav class="year-filter mb-3" aria-label="Year filters" id="year-nav">
  <a href="#y=all" class="year-link is-active" data-year="all">全部年份</a>
  {% for y in years %}
    | <a href="#y={{ y }}" class="year-link" data-year="{{ y }}">{{ y }}</a>
  {% endfor %}
</nav>

{%- assign year = nil -%}
{%- for post in sorted_posts -%}
  {%- capture currentyear -%}{{ post.date | date: "%Y" }}{%- endcapture -%}
  {%- if currentyear != year -%}
    {%- unless forloop.first -%}
        </ul></section>
    {%- endunless -%}
    <section class="year-block" data-year="{{ currentyear }}">
      <h3 class="post-archive-year">{{ currentyear }}</h3>
      <ul class="post-archive">
    {%- capture year -%}{{ currentyear }}{%- endcapture -%}
  {%- endif -%}

  {%- assign coll = post.collection | default: "" -%}
  {%- if coll == "posts" -%}
    {%- assign dtype = "post" -%}
    {%- assign badge = "文章" -%}
  {%- elsif coll == "weeklies" -%}
    {%- assign dtype = "weekly" -%}
    {%- assign badge = "周刊" -%}
  {%- else -%}
    {%- assign dtype = coll -%}
    {%- assign badge = coll -%}
  {%- endif -%}

  <li class="archive-item" data-type="{{ dtype }}" {% if post.featured %}data-featured="1"{% endif %}>
    <span class="post-archive-badge" style="font-size:.8rem; color:#888; margin-right:.5rem;">{{ badge }}</span>
    <a href="{{ post.url | relative_url }}" class="post-archive-link">{{ post.title }}</a>
    <time class="post-archive-date" datetime="{{ post.date | date_to_xmlschema }}" style="margin-left:.5rem; color:#888;">
        {{ post.date | date: "%m-%d" }}
    </time>
    {% if post.featured %}
        <span class="featured-star" title="精选" aria-label="精选">★</span>
    {% endif %}</li>

{%- endfor -%}
</ul></section>

<noscript>
  （已显示全部；启用 JavaScript 可使用“类型 / 年份 / 精选”筛选与动态计数。）
</noscript>
